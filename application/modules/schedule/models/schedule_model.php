<?php ob_start(); ?><?php if ( ! defined('BASEPATH')) exit('No direct script access allowed'); ?><?phpclass schedule_model extends CI_Model {    function  __construct() {        parent::__construct();        date_default_timezone_set('Asia/Jakarta');        $this->load->helper('form');        $this->load->library('showuser');        $this->load->library('generated_tanggal');    }        function getSchedule($limit,$offset)    {        $this->db->where('schdate >', date("Y-m-d H:i:s"));        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->limit($limit, $offset);        $this->db->order_by('idschedules', 'DESC');        $q =  $this->db->get("schedules");        return $q->result();    }        public function count_schedule() {            $this->db->where('schdate >', date("Y-m-d H:i:s"));            $query = $this->db->get("schedules");             return $query->num_rows();     }    public function getTestschedule() {      $partner = $this->uri->segment(3);      $query = $this->db->query('select * from branches where idpartners="'.$partner.'"');      foreach ($query->result() as $row ) { ?>                 <option value="<?php echo $row->idbranches ?>"><?php echo $row->branchname ?></option>     <?php  }    }    public function addschedule() {        $partner = $this->input->post('selectpartner');        $test = $this->input->post('testvenue');        $module = $this->input->post('module');        $date = $this->input->post('date_of_birth');        $closingreg = $this->input->post('closingreg');        $dollar = $this->input->post('dollar');        $gbp = $this->input->post('gbp');        $rupiah = $this->input->post('rupiah');        $maximumuser = $this->input->post('maximumuser');        $isactive = $this->input->post('isactive');        $data = array(            'idbranches' => $test,            'idexams' => $module,            'schdate' => $date,            'schclosingreg' => $closingreg,            'dollar' => $dollar,            'gbp' => $gbp,            'rupiah' => $rupiah,            'maxuser' => $maximumuser,            'schstatus' => $isactive,            'created' => date("Y-m-d H:i:s"),            'createdby' => $this->session->userdata('idusers'),            );        $query = $this->db->insert('schedules',$data);        if($query) {          $status = array('status'=> 'sukses');          echo json_encode($status);        } else {          $status = array('status'=> 'gagal');          echo json_encode($status);        }    }    public function updateschedule() {        $idschedules = $this->input->post('idschedules');        $partner = $this->input->post('selectpartners');        $test = $this->input->post('testvenues');        $module = $this->input->post('modules');        $date = $this->input->post('date_of_birth');        $closingreg = $this->input->post('closingreg');        $dollar = $this->input->post('dollar');        $gbp = $this->input->post('gbp');        $rupiah = $this->input->post('rupiah');        $maximumuser = $this->input->post('maximumuser');        $isactive = $this->input->post('isactive');        if($closingreg < date("Y-m-d H:i:s")) {           $isactive = 2;         }        $data = array(            'idbranches' => $test,            'idexams' => $module,            'schdate' => $date,            'schclosingreg' => $closingreg,            'dollar' => $dollar,            'gbp' => $gbp,            'rupiah' => $rupiah,            'maxuser' => $maximumuser,            'schstatus' => $isactive,            'created' => date("Y-m-d H:i:s"),            'createdby' => $this->session->userdata('idusers'),            );        $this->db->where('idschedules',$idschedules);            $query = $this->db->update('schedules',$data);        if($query) {          $status = array('statuss'=> 'sukses','idschedules' => $idschedules,'schstatus' =>  $isactive);          echo '{"result":'.json_encode($status).'}';        } else {          $status = array('status'=> 'gagal');          echo json_encode($status);        }    }    function getnewschedule() {        $this->db->where('schdate >', date("Y-m-d H:i:s"));        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->limit(1);        $this->db->order_by('idschedules', 'DESC');        $q =  $this->db->get("schedules");        return $q->result();    }    function getupdateschedule() {        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->where('schedules.idschedules', $this->uri->segment(3));        $q =  $this->db->get("schedules");        return $q->result();    }    function geteditschedule() {        $schedules = $this->uri->segment(3);        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->where('schedules.idschedules', $schedules );        $q =  $this->db->get("schedules");        return $q->result();    }    function getpartnername($table,$id) {            $this->db->where('idpartners',$id);            $q = $this->db->get($table);            foreach ($q->result() as $row ) {                $name = $row->partnername;                return $name;            }    }    function deleteschedules() {      $idexams = $this->input->post('idschedules');          $this->db->where('idschedules', $idexams);      $query = $this->db->delete('schedules');        if($query) {          $status = array('status'=> $idexams);          echo json_encode($status);        }    }    function filterbydate($date,$limit,$offset) {          $this->db->where('schdate', $date);        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->limit($limit, $offset);        $this->db->order_by('idschedules', 'DESC');        $q =  $this->db->get("schedules");        return $q->result();    }    public function count_scheduledate($date) {            $this->db->where('schdate', $date);            $this->db->join("branches","schedules.idbranches = branches.idbranches");            $this->db->join("exams","schedules.idexams = exams.idexams");            $q =  $this->db->get("schedules");            return $q->num_rows();    }    function filterbyvenue($venue,$limit,$offset) {          $this->db->where('schedules.idbranches', $venue);        $this->db->where('schdate >', date("Y-m-d H:i:s"));        $this->db->join("branches","schedules.idbranches = branches.idbranches");        $this->db->join("exams","schedules.idexams = exams.idexams");        $this->db->limit($limit, $offset);        $this->db->order_by('idschedules', 'DESC');        $q =  $this->db->get("schedules");        return $q->result();    }    public function count_schedulevenue($date) {            $this->db->where('schedules.idbranches', $date);            $this->db->where('schdate >', date("Y-m-d H:i:s"));            $this->db->join("branches","schedules.idbranches = branches.idbranches");            $this->db->join("exams","schedules.idexams = exams.idexams");            $q =  $this->db->get("schedules");            return $q->num_rows();    }}?>